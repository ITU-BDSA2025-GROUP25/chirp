@page "/private"
@model Chirp.Razor.Pages.PrivateModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Your Private Timeline";
    Layout = "Shared/_Layout";
}

<div>
    <h2>Your Private Timeline</h2>
    
    <div style="margin-bottom: 10px;">
        <form method="get" style="display:inline;">
            <button name="sort" value="newest" class="btn btn-sm btn-secondary">Newest</button>
        </form>

        <form method="get" style="display:inline;">
            <button name="sort" value="liked" class="btn btn-sm btn-secondary">Most Liked</button>
        </form>
    </div>

    @if (Model.Cheeps.Any())
    {
        <ul class="cheeps">
            @foreach (var cheep in Model.Cheeps)
            {
                <li style="position: relative; padding-right: 80px;">
                    <strong>
                        <a href="/@cheep.AuthorName">@cheep.AuthorName</a>
                    </strong>

                    @* Unfollow button *@
                    @if (User.Identity!.IsAuthenticated)
                    {
                        <form method="post"
                              asp-page-handler="Unfollow"
                              asp-route-user="@cheep.AuthorName"
                              style="position: absolute; top: 0; right: 0;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-sm btn-secondary">Unfollow</button>
                        </form>
                    }

                    <p>@cheep.Message</p>
                    <small style="color:gray;">@cheep.Timestamp</small>

                    @* Like / Unlike *@
                    @if (cheep.HasLiked)
                    {
                        <form method="post"
                              asp-page-handler="Unlike"
                              asp-route-cheepId="@cheep.CheepId"
                              style="display:inline;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-sm btn-warning">💔 Unlike</button>
                        </form>
                    }
                    else
                    {
                        <form method="post"
                              asp-page-handler="Like"
                              asp-route-cheepId="@cheep.CheepId"
                              style="display:inline;">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-sm btn-success">❤️ Like</button>
                        </form>
                    }

                    <span>(@cheep.LikeCount likes)</span>
                    
                </li>
            }
        </ul>

        <div style="margin-top:20px; display:flex; align-items:center; gap:12px;">

            @* PREVIOUS BUTTON *@
            @if (Model.CurrentPage > 1)
            {
                <form method="get" action="/private" style="margin:0;">
                    <input type="hidden" name="page" value="@(Model.CurrentPage - 1)"/>
                    <button type="submit" class="btn btn-secondary">⬅ Previous</button>
                </form>
            }

            <span>Page @Model.CurrentPage</span>

            @* NEXT BUTTON *@
            @if (Model.HasMorePages)
            {
                <form method="get" action="/private" style="margin:0;">
                    <input type="hidden" name="page" value="@(Model.CurrentPage + 1)"/>
                    <button type="submit" class="btn btn-primary">Next ➡</button>
                </form>
            }
        </div>
    }
    else
    {
        <em>No cheeps from people you follow.</em>
    }
</div>
